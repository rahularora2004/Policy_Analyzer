<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Law & Policy Analyzer</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles from the original React component */
        body {
            font-family: 'Inter', sans-serif;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        /* Styles for prose class to format the output text */
        .prose h1, .prose h2, .prose h3 { color: #334155; }
        .prose strong { color: #475569; }
        .prose p { margin-bottom: 1em; }
        .prose ul { list-style-position: inside; }
        .prose li { margin-bottom: 0.5em; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header Section -->
    <header class="bg-gray-900 text-white p-6 shadow-lg">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl font-bold tracking-tight">AI Law & Policy Analyzer</h1>
            <p class="mt-2 text-lg text-gray-300">Transforming complex legal jargon into clear, understandable insights.</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 md:p-8">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-4xl mx-auto">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Enter Legal Text</h2>
            <p class="text-gray-600 mb-6">
                Paste the content of a bill, judgment, or policy document below. The AI will break it down for you.
            </p>
            
            <!-- Text Input Area -->
            <textarea
                id="inputText"
                placeholder="Paste your legal text here..."
                class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y"
            ></textarea>

            <!-- Analyze Button -->
            <div class="mt-6 text-center">
                <button
                    id="analyzeButton"
                    class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg"
                >
                    Analyze Text
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultContainer" class="max-w-4xl mx-auto mt-10">
            <!-- Loading spinner will be injected here -->
            <!-- Error message will be injected here -->
            <!-- Analysis result will be injected here -->
        </div>
    </main>
    
    <!-- Footer Section -->
    <footer class="bg-gray-900 text-white py-6 mt-12">
        <div class="container mx-auto text-center px-4">
            <p class="text-gray-400 font-semibold">
                Portfolio Punchline: "Built an AI-powered tool that translates complex policies and court judgments into actionable, plain-language insights for citizens and researchers."
            </p>
            <p class="text-sm text-gray-500 mt-2">
                Powered by Google Gemini
            </p>
        </div>
    </footer>

    <script>
        // --- DOM Element References ---
        const inputTextElem = document.getElementById('inputText');
        const analyzeButton = document.getElementById('analyzeButton');
        const resultContainer = document.getElementById('resultContainer');

        // --- Helper Function to call Gemini API ---
        const callGeminiAPI = async (prompt, retries = 3, delay = 1000) => {
            const apiKey = ""; // Leave as-is, Canvas will handle it
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: { temperature: 0.5, topK: 1, topP: 1 }
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2; // Exponential backoff
                }
            }
        };

        // --- UI Update Functions ---
        const showLoading = () => {
            resultContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center p-8">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500"></div>
                    <p class="mt-4 text-gray-400">Analyzing document...</p>
                </div>
            `;
        };

        const showError = (message) => {
            resultContainer.innerHTML = `
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md" role="alert">
                    <p class="font-bold">An Error Occurred</p>
                    <p>${message}</p>
                </div>
            `;
        };

        const showResult = (result) => {
            // Basic markdown-to-HTML conversion for headings and bold text
            let formattedResult = result
                .replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-6 mb-3">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mt-6 mb-4">$1</h1>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');

            resultContainer.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-inner animate-fade-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 pb-2 border-gray-200">Analysis Complete</h2>
                    <div class="prose prose-lg max-w-none text-gray-700">
                        ${formattedResult}
                    </div>
                </div>
            `;
        };

        // --- Main Analysis Logic ---
        const handleAnalyze = async () => {
            const inputText = inputTextElem.value;
            if (!inputText.trim()) {
                showError("Please paste some legal text to analyze.");
                return;
            }

            // Disable button and show loader
            analyzeButton.disabled = true;
            analyzeButton.textContent = 'Analyzing...';
            showLoading();

            const prompt = `
                Analyze the following legal or policy document. Your task is to act as a legal expert simplifying complex text for the general public.
                Provide a clear, plain-language summary. Break down the key points, explain the potential impact on citizens or relevant parties, and highlight any actionable items or important dates.
                Structure your output with clear headings (e.g., using '##' for main sections and '###' for subsections). Use markdown for formatting like bold text with **.

                Here is the document:
                ---
                ${inputText}
                ---
            `;

            try {
                const result = await callGeminiAPI(prompt);
                showResult(result);
            } catch (err) {
                console.error("Failed to get analysis from API:", err);
                showError("Sorry, we couldn't analyze the document. The server might be busy. Please try again later.");
            } finally {
                // Re-enable button
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'Analyze Text';
            }
        };

        // --- Event Listener ---
        analyzeButton.addEventListener('click', handleAnalyze);

    </script>
</body>
</html>
